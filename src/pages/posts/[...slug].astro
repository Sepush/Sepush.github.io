---
import { type CollectionEntry, getCollection } from "astro:content";
import { SocialShare } from "../../components/social";
import { TagGroup } from "../../components/tag";
import Toc from "../../components/Toc.astro";
import Layout from "../../layouts/Layout.astro";
import { formatDate } from "../../utils";

export async function getStaticPaths() {
  const posts = await getCollection("posts");

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

interface Props {
  post: CollectionEntry<"posts">;
}

const { post } = Astro.props;
const { Content, headings } = await post.render();

const postTags = post.data.tags.map((tag) => {
  return {
    tag,
  };
});
---

<Layout
  title={`${post.data.title} - Artea`}
  description={post.data.description}
>
  <div class="min-h-screen">
    <main class="max-w-4xl mx-auto px-4 sm:px-6 py-8 sm:py-12 overflow-hidden">
      <header class="flex flex-col gap-y-4">
        <nav>
          <a
            href="/posts"
            class="inline-flex items-center justify-center w-8 h-8 text-gray-600 hover:text-gray-900 transition-colors rounded-lg hover:bg-gray-100"
          >
            <span class="i-tabler-arrow-left text-lg"></span>
          </a>
        </nav>
        <h1
          class="text-2xl sm:text-4xl md:text-5xl font-bold text-gray-900 leading-tight tracking-tight break-words"
        >
          {post.data.title}
        </h1>
        {
          post.data.description && (
            <p class="text-lg sm:text-xl text-gray-600 leading-relaxed max-w-3xl">
              {post.data.description}
            </p>
          )
        }
        <div class="flex flex-wrap items-center gap-6 text-sm text-gray-500">
          <div class="flex items-center gap-2">
            <span class="i-tabler-calendar text-gray-400"></span>
            <time datetime={post.data.pubDate.toISOString()}>
              {formatDate(post.data.pubDate)}
            </time>
          </div>
          {
            post.data.updatedDate && (
              <div class="flex items-center gap-2">
                <span class="i-tabler-edit text-gray-400" />
                <span>更新于 {formatDate(post.data.updatedDate)}</span>
              </div>
            )
          }
        </div>

        <TagGroup tags={postTags} />
      </header>

      <article class="prose max-w-none min-w-0">
        <Content />
      </article>

      <footer
        class="pt-8 border-t border-gray-200 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"
      >
        <div class="text-sm text-gray-500">
          <span>如果觉得这篇文章有点意思，欢迎分享给更多人！</span>
        </div>
        <div class="flex items-center gap-3">
          <SocialShare
            title={post.data.title}
            url={Astro.url.href}
            platforms={["x"]}
            size="md"
          />
        </div>
      </footer>
    </main>
    <Toc headings={headings} maxDepth={3} position="fixed" />
  </div>
</Layout>
